{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport BuildFailureDetails from '@/components/docs/versions/build-failure-details';\nimport DockerImageLinkOrRetryButton from '@/components/docs/versions/docker-image-link-or-retry-button';\nimport Spinner from '@/components/reusable/spinner';\nimport React from 'react';\nimport { useFirestore, useFirestoreCollectionData } from 'reactfire';\nimport { Table, Tooltip } from 'antd';\nimport styles from './builds.module.scss';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { createElement as _createElement } from \"react\";\nvar mapBuildStatusToIcon = {\n  started: /*#__PURE__*/_jsx(Spinner, {\n    type: \"slow\"\n  }),\n  failed: '⚠',\n  published: '✅'\n};\n\nvar Builds = function Builds(_ref) {\n  var ciJobId = _ref.ciJobId,\n      repoVersionInfo = _ref.repoVersionInfo,\n      editorVersionInfo = _ref.editorVersionInfo,\n      props = _objectWithoutProperties(_ref, [\"ciJobId\", \"repoVersionInfo\", \"editorVersionInfo\"]);\n\n  var loading = /*#__PURE__*/_jsx(\"p\", {\n    children: \"Fetching builds...\"\n  });\n\n  var ciBuilds = useFirestore().collection('ciBuilds').where('relatedJobId', '==', ciJobId);\n\n  var _useFirestoreCollecti = useFirestoreCollectionData(ciBuilds),\n      status = _useFirestoreCollecti.status,\n      data = _useFirestoreCollecti.data;\n\n  var isLoading = status === 'loading';\n\n  if (isLoading) {\n    return loading;\n  }\n\n  var columns = [{\n    width: 45,\n    dataIndex: 'status',\n    key: 'status',\n    render: function render(value, record) {\n      var _record$failure;\n\n      var icon = mapBuildStatusToIcon[value];\n\n      switch (value) {\n        case 'published':\n          return icon;\n\n        case 'failed':\n          return /*#__PURE__*/_jsx(Tooltip, {\n            title: (_record$failure = record.failure) === null || _record$failure === void 0 ? void 0 : _record$failure.reason,\n            children: icon\n          });\n\n        case 'started':\n          return /*#__PURE__*/_jsx(Tooltip, {\n            title: \"Build has started\",\n            children: icon\n          });\n\n        default:\n          return value;\n      }\n    }\n  }, {\n    width: 45,\n    render: function render(value, record) {\n      return /*#__PURE__*/_jsx(DockerImageLinkOrRetryButton, {\n        record: record\n      });\n    },\n    key: 'docker-image-link-or-retry-button'\n  }, {\n    title: 'Build identifier',\n    dataIndex: 'buildId',\n    key: 'buildId',\n    onFilter: function onFilter(value, record) {\n      return record.buildId.includes(value);\n    },\n    defaultSortOrder: 'ascend',\n    sorter: function sorter(a, b) {\n      return a.buildId.localeCompare(b.buildId, 'en-GB');\n    },\n    ellipsis: true\n  }, {\n    title: 'Image type',\n    dataIndex: 'imageType',\n    key: 'imageType',\n    onFilter: function onFilter(value, record) {\n      return record.imageType.includes(value);\n    },\n    sorter: function sorter(a, b) {\n      return a.imageType.localeCompare(b.imageType, 'en-GB');\n    },\n    ellipsis: true\n  }, {\n    title: 'OS',\n    dataIndex: ['buildInfo', 'baseOs'],\n    key: 'buildInfo.baseOs',\n    onFilter: function onFilter(value, record) {\n      return record.buildInfo.baseOs.includes(value);\n    },\n    sorter: function sorter(a, b) {\n      return a.buildInfo.baseOs.localeCompare(b.buildInfo.baseOs, 'en-GB');\n    },\n    ellipsis: true\n  }, {\n    title: 'Target platform',\n    dataIndex: ['buildInfo', 'targetPlatform'],\n    key: 'buildInfo.targetPlatform',\n    onFilter: function onFilter(value, record) {\n      return record.buildInfo.targetPlatform.includes(value);\n    },\n    sorter: function sorter(a, b) {\n      return a.buildInfo.targetPlatform.localeCompare(b.buildInfo.targetPlatform, 'en-GB');\n    },\n    ellipsis: true\n  }, {\n    title: 'Editor version',\n    dataIndex: ['buildInfo', 'editorVersion'],\n    key: 'buildInfo.editorVersion',\n    onFilter: function onFilter(value, record) {\n      return record.buildInfo.editorVersion.includes(value);\n    },\n    sorter: function sorter(a, b) {\n      return a.buildInfo.editorVersion.localeCompare(b.buildInfo.editorVersion, 'en-GB');\n    },\n    ellipsis: true\n  }, {\n    title: 'Repo version',\n    dataIndex: ['buildInfo', 'repoVersion'],\n    key: 'buildInfo.repoVersion',\n    onFilter: function onFilter(value, record) {\n      return record.buildInfo.repoVersion.includes(value);\n    },\n    sorter: function sorter(a, b) {\n      return a.buildInfo.repoVersion.localeCompare(b.buildInfo.repoVersion, 'en-GB');\n    },\n    ellipsis: true\n  }];\n  var expandable = {\n    rowExpandable: function rowExpandable() {\n      return true;\n    },\n    expandedRowClassName: function expandedRowClassName() {\n      return styles.expandedContentRow;\n    },\n    expandedRowRender: function expandedRowRender(record) {\n      return /*#__PURE__*/_jsx(BuildFailureDetails, {\n        style: {\n          margin: 0\n        },\n        ciJob: ciJobId,\n        editorVersionInfo: editorVersionInfo,\n        repoVersionInfo: repoVersionInfo,\n        ciBuild: record\n      });\n    }\n  };\n  return /*#__PURE__*/_createElement(Table, _objectSpread(_objectSpread({}, props), {}, {\n    key: ciJobId,\n    dataSource: data,\n    columns: columns,\n    sticky: true,\n    rowKey: function rowKey(row) {\n      return row.NO_ID_FIELD;\n    },\n    rowClassName: function rowClassName() {\n      return styles.stickyRow;\n    },\n    expandable: expandable,\n    pagination: false\n  }));\n};\n\nexport default Builds;","map":null,"metadata":{},"sourceType":"module"}